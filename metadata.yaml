--- metadata.yaml ---
# AWS Service Catalog Product Metadata
# Product: Cross-Account Assume Role for Airflow EKS Pod Identity
# Version: 1.0.0
# Owner: Platform Team

SchemaVersion: '1.0'

ProductInformation:
  ProductName: crossaccountassumerole
  ProductId: prod-crossaccount-airflow-irsa
  ProductType: CLOUD_FORMATION_TEMPLATE
  
  DisplayName: 'Cross-Account Assume Role for Airflow (EKS IRSA)'
  
  Description: |
    AWS Service Catalog product for configuring cross-account IAM assume role 
    access for Apache Airflow using EKS Pod Identity (IRSA). This product enables 
    secure cross-account access from Airflow workers running in Account A (EKS cluster) 
    to S3 resources in Account B using a proper IAM trust chain.
    
    Architecture:
    - Account A (Source): EKS cluster with pod identity role (Role A)
    - Account B (Target): S3 resources with target role (Role B)
    - Trust Chain: K8s ServiceAccount → Role A → Role B → S3
    
    Deployment Model:
    1. Deploy in Account A to create Role A and assume policy
    2. Deploy in Account B to create Role B with S3 permissions
    3. Configure EKS pod identity association
    4. Annotate Kubernetes ServiceAccount
    
    Use Cases:
    - Cross-account S3 access for Airflow DAGs
    - Secure data pipeline orchestration
    - Multi-account data lake architectures
    - Compliance-driven account separation
  
  ShortDescription: 'Configure cross-account IAM roles for Airflow EKS Pod Identity with S3 access'
  
  Owner: Platform Team
  
  Distributor: Cloud Infrastructure Team
  
  # Support information
  SupportInformation:
    SupportEmail: platform-team@example.com
    SupportUrl: https://wiki.example.com/aws/service-catalog/cross-account-role
    SupportDescription: |
      For support with this Service Catalog product:
      - Email: platform-team@example.com
      - Slack: #platform-support
      - Confluence: https://wiki.example.com/aws/airflow-cross-account
      - Incident Management: ServiceNow (Assignment Group: Cloud Platform)
      
      Response SLA:
      - P1 (Production Down): 15 minutes
      - P2 (Major Impact): 2 hours
      - P3 (Minor Impact): 1 business day
      - P4 (General Question): 2 business days

# Version information
ProductVersion:
  VersionName: v1.0.0
  VersionDescription: |
    Initial release of cross-account assume role product for Airflow.
    
    Features:
    - Support for EKS Pod Identity (IRSA)
    - Configurable S3 access (full or prefix-based)
    - Dual-account deployment model
    - External ID for enhanced security
    - Comprehensive parameter validation
    - Production-ready tagging strategy
    - Detailed outputs and next-steps guidance
    
    Tested with:
    - EKS 1.28+
    - Apache Airflow 2.7+
    - AWS CLI v2
    - kubectl 1.28+
  
  Active: true
  CreatedTime: '2025-01-15T00:00:00Z'
  
  # Guidance for version management
  VersionGuidance: RECOMMENDED

# Provisioning artifact details
ProvisioningArtifact:
  ArtifactName: crossaccountassumerole-v1.0.0
  
  ArtifactDescription: 'CloudFormation template for cross-account Airflow IAM configuration'
  
  # S3 location where the CloudFormation template (product.yaml) is stored
  # Update this with your actual S3 bucket and path
  Info:
    LoadTemplateFromURL: 'https://s3.amazonaws.com/your-service-catalog-bucket/products/crossaccountassumerole/v1.0.0/product.yaml'
  
  # Alternative: Direct template specification
  # Uncomment and use if you want to embed the template directly
  # TemplateUrl: 's3://your-service-catalog-bucket/products/crossaccountassumerole/v1.0.0/product.yaml'
  
  Type: CLOUD_FORMATION_TEMPLATE
  
  DisableTemplateValidation: false

# Product tagging
Tags:
  - Key: Product
    Value: crossaccountassumerole
  
  - Key: ProductOwner
    Value: PlatformTeam
  
  - Key: ServiceCatalogManaged
    Value: 'true'
  
  - Key: Environment
    Value: production
  
  - Key: Compliance
    Value: SOC2-PCI-DSS
  
  - Key: CostCenter
    Value: CloudInfrastructure
  
  - Key: DataClassification
    Value: Internal
  
  - Key: BackupRequired
    Value: 'false'
  
  - Key: ManagedBy
    Value: ServiceCatalog
  
  - Key: ProductVersion
    Value: v1.0.0
  
  - Key: LastUpdated
    Value: '2025-01-15'
  
  - Key: Documentation
    Value: https://wiki.example.com/aws/service-catalog/cross-account-role

# Portfolio assignment (reference)
# This product should be added to relevant portfolios
PortfolioAssociation:
  SuggestedPortfolios:
    - Name: 'Data Platform Products'
      Description: 'Service Catalog products for data platform infrastructure'
      
    - Name: 'Cross-Account Access Products'
      Description: 'Products enabling secure cross-account access patterns'
      
    - Name: 'EKS Platform Products'
      Description: 'Products supporting EKS cluster operations and integrations'

# Launch constraints and governance
LaunchConstraints:
  # IAM role constraint for launching this product
  # Users must have this role or equivalent permissions
  RequiredIAMRole: 'arn:aws:iam::ACCOUNT_ID:role/ServiceCatalogProductLaunchRole'
  
  # Notification configuration
  NotificationArns:
    - 'arn:aws:sns:eu-west-1:ACCOUNT_ID:service-catalog-notifications'
  
  # Stack set constraints (if using StackSets for multi-account deployment)
  StackSetConstraints:
    Enabled: false
    Description: 'Manual deployment in each account required'

# Provisioning preferences
ProvisioningPreferences:
  # Default parameter values can be set at portfolio level
  DefaultParameters: {}
  
  # Template constraints
  TemplateConstraints:
    Rules:
      - RuleName: ValidateAccountIds
        Description: 'Ensure source and target account IDs are different'
        Assertions:
          - Assert: !Not [!Equals [!Ref SourceAccountId, !Ref TargetAccountId]]
            AssertDescription: 'Source and Target account IDs must be different'

# Change management
ChangeManagement:
  ChangeApprovalRequired: true
  ChangeApproverRole: 'arn:aws:iam::ACCOUNT_ID:role/ServiceCatalogChangeApprover'
  ChangeNotificationTopic: 'arn:aws:sns:eu-west-1:ACCOUNT_ID:service-catalog-changes'

# Cost estimation
CostInformation:
  EstimatedMonthlyCost: 0.00
  CostNotes: |
    This product creates IAM roles and policies only, which have no direct cost.
    Actual costs depend on:
    - API calls made using the assumed roles (minimal)
    - S3 operations performed through Role B (varies by usage)
    - Data transfer costs (if cross-region)
    
    Typical monthly cost: $0-5 for IAM API calls and S3 operations

# Documentation and resources
Documentation:
  UserGuide: 'https://wiki.example.com/aws/service-catalog/cross-account-role/user-guide'
  
  TechnicalDocumentation: 'https://wiki.example.com/aws/service-catalog/cross-account-role/technical'
  
  VideoTutorial: 'https://training.example.com/aws/cross-account-airflow-setup'
  
  FAQUrl: 'https://wiki.example.com/aws/service-catalog/cross-account-role/faq'
  
  TroubleshootingGuide: 'https://wiki.example.com/aws/service-catalog/cross-account-role/troubleshooting'
  
  BestPractices: |
    1. Always deploy in Account A first, then Account B
    2. Use unique role names to avoid conflicts
    3. Implement least-privilege S3 access (use bucket prefix)
    4. Test the trust chain before production use
    5. Monitor AssumeRole CloudTrail events
    6. Rotate External IDs periodically
    7. Document the ExternalId in your configuration management
    8. Use AWS Config rules to monitor role trust policies
    9. Implement automated testing of cross-account access
    10. Keep role names and policies consistent across environments

# Compliance and security
ComplianceInformation:
  ComplianceFrameworks:
    - SOC2-Type2
    - PCI-DSS
    - HIPAA-eligible
    - ISO-27001
  
  SecurityControls:
    - External ID validation
    - Least-privilege IAM policies
    - Conditional trust policies
    - CloudTrail logging enabled
    - AWS Config monitoring recommended
  
  DataResidency: 'Supports region-specific deployments for data residency compliance'
  
  EncryptionSupport: 'IAM roles support S3 buckets with SSE-KMS encryption'

# Product lifecycle
Lifecycle:
  Status: Active
  
  MaintenanceSchedule: 'Quarterly review and updates'
  
  DeprecationPolicy: |
    - 90-day notice before deprecation
    - Migration guide provided for replacement products
    - Support extended for 180 days post-deprecation
  
  UpdateFrequency: 'As needed for security patches and feature requests'

# Integration information